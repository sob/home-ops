---
apiVersion: v1
kind: ConfigMap
metadata:
  name: mystic-doors-config
data:
  doors.conf: |
    #!/bin/bash
    # Mystic BBS Door Configuration
    #
    # This file defines the available DOS doors for Mystic BBS.
    # Edit this ConfigMap to add or modify door configurations.
    #
    # For each door, define three variables:
    #   DOOR_CMD[name]   - The DOS command to execute
    #   DOOR_PATH[name]  - The DOS path to the door directory
    #   DOOR_DESC[name]  - Human-readable description
    #
    # Important notes:
    # - Door names should be lowercase
    # - Use DOS-style paths with backslashes (C:\\DOORS\\...)
    # - Paths are relative to the dosemu C: drive (/doors/dosemu/drive_c)
    # - DOOR.SYS will be automatically placed in C:\NODES\TEMP{N}\

    # Example: Legend of the Red Dragon (LORD)
    DOOR_CMD[lord]="START.BAT"
    DOOR_PATH[lord]="C:\\DOORS\\LORD"
    DOOR_DESC[lord]="Legend of the Red Dragon"

    # Example: Trade Wars 2002
    DOOR_CMD[tw2002]="TW2002.EXE TWNODE.CFG"
    DOOR_PATH[tw2002]="C:\\DOORS\\TW2002"
    DOOR_DESC[tw2002]="Trade Wars 2002"

    # Example: Darkness
    DOOR_CMD[dark]="DARK.EXE DARK.CFG"
    DOOR_PATH[dark]="C:\\DOORS\\DARKNESS"
    DOOR_DESC[dark]="Darkness"

    # Example: Barren Realms Elite (BRE)
    DOOR_CMD[bre]="BRE.EXE BRE.CFG"
    DOOR_PATH[bre]="C:\\DOORS\\BRE"
    DOOR_DESC[bre]="Barren Realms Elite"

    # Example: Galactic Dynasty
    DOOR_CMD[dynasty]="DYNASTY.EXE"
    DOOR_PATH[dynasty]="C:\\DOORS\\DYNASTY"
    DOOR_DESC[dynasty]="Galactic Dynasty"

    # Example: LORD II: New World
    DOOR_CMD[lord2]="LORD2.EXE"
    DOOR_PATH[lord2]="C:\\DOORS\\LORD2"
    DOOR_DESC[lord2]="LORD II: New World"

    # Example: Planets: The Exploration of Space (TEOS)
    DOOR_CMD[teos]="TEOS.EXE"
    DOOR_PATH[teos]="C:\\DOORS\\TEOS"
    DOOR_DESC[teos]="Planets: TEOS"

    # Example: Usurper
    DOOR_CMD[usurper]="USURPER.EXE"
    DOOR_PATH[usurper]="C:\\DOORS\\USURPER"
    DOOR_DESC[usurper]="Usurper"

    # Example: Solar Realms Elite (SRE)
    DOOR_CMD[sre]="SRE.EXE"
    DOOR_PATH[sre]="C:\\DOORS\\SRE"
    DOOR_DESC[sre]="Solar Realms Elite"

    # Example: Operation Overkill
    DOOR_CMD[oo]="OVERKILL.EXE"
    DOOR_PATH[oo]="C:\\DOORS\\OO"
    DOOR_DESC[oo]="Operation Overkill"

    # ---
    # Installing Doors with install-door.sh
    # ---
    #
    # Use 'kubectl exec' to install doors easily:
    #   kubectl exec -it deployment/mystic-bbs -- install-door.sh list
    #   kubectl exec -it deployment/mystic-bbs -- install-door.sh lord
    #
    # Available doors: lord, tw2002, bre, teos, usurper, sre, darkness, oo
    #
    # The installer automatically:
    #   - Downloads the door archive from a known source
    #   - Extracts the archive to C:\DOORS\{NAME}
    #   - Extracts nested archives if specified (e.g., LORD.ZIP inside lord407.zip)
    #   - Converts text files to Unix format
    #   - Sets executable permissions on .exe and .bat files
    #
    # Nested archives are explicitly configured in install-door.sh catalog:
    #   Format: name|desc|url|type|dir|nested_archives
    #   Example: ["lord"]="...|...|...|lord|LORD.ZIP"
    #   Supports multiple: "GAME.ZIP,DATA.ARJ" (comma-separated)
    #
    # Example installation workflow:
    #   1. kubectl exec -it deployment/mystic-bbs -- install-door.sh lord
    #   2. Wait for extraction (nested archives are handled automatically)
    #   3. Configure in Mystic BBS Menu Editor:
    #      - Open Menu Editor: System > Menu Editor
    #      - Select your main menu or door menu
    #      - Add new menu command (Insert key)
    #      - Command: DD (Execute Door)
    #      - Data: /usr/local/bin/rundoor.sh %N lord /DOS
    #      - Optional settings:
    #        * Hot Key: L (for LORD)
    #        * Display Text: (L) Play Legend of the Red Dragon
    #        * Security Level: Set as needed
    #
    # Mystic BBS Menu Command Reference (DD - Execute Door):
    #   Format: <command line> /DOS
    #
    #   Available MCI Codes:
    #     %N = Current node number
    #     %# = User's unique ID
    #     %U = User's handle (underscores for spaces)
    #     %A = User's real name (underscores for spaces)
    #     %B = User's real name (with spaces)
    #     %T = User's time left in minutes
    #     %P = Node's temp directory
    #
    #   Example: /usr/local/bin/rundoor.sh %N lord /DOS
    #
    #   The /DOS flag ensures DOOR.SYS is created in DOS text format.
    #   rundoor.sh handles the door execution and drop file placement.
    #
    # More info: https://wiki.mysticbbs.com/doku.php?id=menu_commands
    #
    # Troubleshooting Door Execution:
    #   Door execution logs are written to: /config/logs/doors.log
    #
    #   View logs:
    #     kubectl exec -it deployment/mystic-bbs -- tail -f /config/logs/doors.log
    #     kubectl exec -it deployment/mystic-bbs -- cat /config/logs/doors.log
    #
    #   Log rotation (via logrotate):
    #     - Rotates daily or when log exceeds 10MB (whichever comes first)
    #     - Keeps 7 days of compressed backups
    #     - Managed by system logrotate (runs via cron)
    #     - View backups: ls -lh /config/logs/
    #
    #   Each log entry includes:
    #     - Timestamp
    #     - Node number
    #     - Username
    #     - Door name
    #     - Door path and command
    #     - dosemu stdout/stderr output (real-time and logged)
    #     - Exit code
    # ---

    # Add your custom doors below this line
    # DOOR_CMD[mydoor]="MYDOOR.EXE /PARAMS"
    # DOOR_PATH[mydoor]="C:\\DOORS\\MYDOOR"
    # DOOR_DESC[mydoor]="My Custom Door"
