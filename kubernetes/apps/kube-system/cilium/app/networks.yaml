---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/cilium.io/ciliumloadbalancerippool_v2alpha1.json
apiVersion: cilium.io/v2alpha1
kind: CiliumLoadBalancerIPPool
metadata:
  name: cilium-pool
spec:
  blocks:
    - start: "${CILIUM_LB_RANGE_START}"
      stop: "${CILIUM_LB_RANGE_END}"
  disabled: false  # Set to true to disable during testing
  # Optional: disable automatic allocation for certain services
  # serviceSelector:
  #   matchExpressions:
  #   - key: io.cilium/manual-ip
  #     operator: NotIn
  #     values: ["true"]
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/cilium.io/ciliumloadbalancerippool_v2alpha1.json
apiVersion: cilium.io/v2alpha1
kind: CiliumLoadBalancerIPPool
metadata:
  name: dns-pool
spec:
  blocks:
    - start: "10.1.100.53"
      stop: "10.1.100.53"
  disabled: false
  serviceSelector:
    matchLabels:
      app.kubernetes.io/name: resolver-blocky
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/cilium.io/ciliumloadbalancerippool_v2alpha1.json
apiVersion: cilium.io/v2alpha1
kind: CiliumLoadBalancerIPPool
metadata:
  name: gateway-internal-pool
spec:
  blocks:
    - start: "${SECRET_CILIUM_INTERNAL_VIP}"
      stop: "${SECRET_CILIUM_INTERNAL_VIP}"
  disabled: false
  serviceSelector:
    matchLabels:
      io.cilium.gateway/owning-gateway: internal-gateway
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/cilium.io/ciliumloadbalancerippool_v2alpha1.json
apiVersion: cilium.io/v2alpha1
kind: CiliumLoadBalancerIPPool
metadata:
  name: gateway-external-pool
spec:
  blocks:
    - start: "${SECRET_CILIUM_EXTERNAL_VIP}"
      stop: "${SECRET_CILIUM_EXTERNAL_VIP}"
  disabled: false
  serviceSelector:
    matchLabels:
      io.cilium.gateway/owning-gateway: external-gateway
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/cilium.io/ciliumloadbalancerippool_v2alpha1.json
apiVersion: cilium.io/v2alpha1
kind: CiliumLoadBalancerIPPool
metadata:
  name: emqx-pool
spec:
  blocks:
    - start: "${SECRET_VIP_EMQX}"
      stop: "${SECRET_VIP_EMQX}"
  disabled: false
  serviceSelector:
    matchLabels:
      apps.emqx.io/instance: emqx
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/cilium.io/ciliuml2announcementpolicy_v2alpha1.json
apiVersion: cilium.io/v2alpha1
kind: CiliumL2AnnouncementPolicy
metadata:
  name: default-l2-announcement-policy
spec:
  # Announce all LoadBalancer services
  loadBalancerIPs: true
  # If you want to be more selective, use:
  # serviceSelector:
  #   matchLabels:
  #     io.cilium/l2-announce: "true"

  # Auto-detect interfaces or specify them
  # interfaces:
  # - eth0
  # - ens3

  # Select which nodes should announce IPs
  nodeSelector:
    matchLabels:
      kubernetes.io/os: linux
