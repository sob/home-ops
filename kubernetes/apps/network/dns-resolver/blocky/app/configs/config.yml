# Blocky DNS Configuration
# Security-hardened DNS resolver with adblocking

# Upstream DNS servers
upstream:
  default:
    # Forward to DNSCrypt-proxy for encrypted DNS
    - resolver-dnscrypt-proxy.network.svc.cluster.local:5053

# Custom DNS mappings for internal domains
customDNS:
  customTTL: 1h
  filterUnmappedTypes: true
  mapping: {}

# Conditional forwarding for specific domains
conditional:
  mapping:
    # Forward cluster.local to CoreDNS
    cluster.local: 10.96.0.10:53
    
# Adblocking configuration
blocking:
  # Block lists
  blackLists:
    ads:
      - https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
      - https://someonewhocares.org/hosts/zero/hosts
      - https://raw.githubusercontent.com/AdguardTeam/AdguardSDNSFilter/master/Filters/filter.txt
      - https://adaway.org/hosts.txt
    malware:
      - https://urlhaus.abuse.ch/downloads/hostfile/
      - https://malware-filter.gitlab.io/malware-filter/urlhaus-filter-hosts.txt
    tracking:
      - https://raw.githubusercontent.com/AdguardTeam/cname-trackers/master/data/combined_disguised_trackers.txt
      - https://raw.githubusercontent.com/AdguardTeam/AdguardSDNSFilter/master/Filters/filter.txt
    native:
      - https://raw.githubusercontent.com/DandelionSprout/adfilt/master/Alternate%20versions%20Anti-Malware%20List/AntiMalwareHosts.txt
      - https://raw.githubusercontent.com/bigdargon/hostsVN/master/hosts
  # Whitelist
  whiteLists:
    ads:
      - https://raw.githubusercontent.com/anudeepND/whitelist/master/domains/whitelist.txt
  # Client-specific settings
  clientGroupsBlock:
    default:
      - ads
      - malware
      - tracking
  blockType: zeroIp
  blockTTL: 6h
  refreshPeriod: 24h
  downloadTimeout: 60s
  downloadAttempts: 3
  downloadCooldown: 5s
  startStrategy: failOnError

# Caching configuration (similar to Unbound's 4GB)
caching:
  minTime: 0s
  maxTime: 24h
  cacheTimeNegative: 30m
  prefetching: true
  prefetchExpires: 2h
  prefetchThreshold: 5
  prefetchMaxItemsCount: 0

# DNSSEC validation
ede:
  enable: true

# Logging configuration
log:
  level: info
  format: text
  timestamp: true
  privacy: false

# Query logging for debugging (disable in production)
queryLog:
  type: none  # Options: none, csv, console, csv-client
  target: ""
  logRetentionDays: 0
  creationAttempts: 1
  creationCooldown: 2s
  flushInterval: 30s

# Prometheus metrics
prometheus:
  enable: true
  path: /metrics

# Redis cache (optional, for HA setups)
redis:
  required: false
  connectionAttempts: 3
  connectionCooldown: 1s

# Port configuration
ports:
  dns: 53
  tls: 853
  https: 443
  http: 4000

# Host/interface binding
# Using 0.0.0.0 to listen on all interfaces
hostsFile:
  filePath: ""
  hostsTTL: 60m
  refreshPeriod: 30m
  filterLoopback: true

# Client lookup for identifying requests
clientLookup:
  upstream: ""
  singleNameOrder:
    - 2
    - 1
  clients: {}

# Bootstrap DNS (for resolving upstream hostnames)
bootstrapDns:
  - tcp+udp:10.96.0.10:53  # Use CoreDNS for bootstrap

# Filtering configuration
filtering:
  queryTypes: []  # Empty to allow all query types

# Rate limiting
ratelimit:
  enable: false
  responsesPerSec: 0
  allowlistsOnly: false

# EDNS configuration
edns:
  useContainerName: false

# Minimal TLS config (not used since we forward to DNSCrypt-proxy)
minTlsServeVersion: 1.3
connectIPVersion: dual

# FQDNs only
fqdnOnly:
  enable: true

# Special use domains
specialUseDomains:
  rfc6762_appendixG: true