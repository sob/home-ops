---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: robusta
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: robusta-secret
    template:
      engineVersion: v2
      data:
        values.yaml: |
          clusterName: stone-metal
          globalConfig:
            signing_key: {{ .ROBUSTA_SIGNING_KEY }}
            account_id: {{ .ROBUSTA_ACCOUNT_ID }}
          sinksConfig:
            - robusta_sink:
                name: robusta_ui_sink
                token: {{ .ROBUSTA_SINK_TOKEN }}
          enablePrometheusStack: false
          enablePlatformPlaybooks: true
          runner:
            sendAdditionalTelemetry: true
          enableHolmesGPT: true
          enabledManagedConfiguration: true
          holmes:
            additionalEnvVars:
              - name: ROBUSTA_AI
                value: "true"
  dataFrom:
    - extract:
        key: robusta
